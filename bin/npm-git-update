#!/usr/bin/env node
var npm = require('npm')
  , fs = require('fs');

var pkgStr = fs.readFileSync('package.json')
  , pkg = JSON.parse(pkgStr);

npm.load(npm.config, function(err) {
  if(err) throw err;

  var gitPackages = [];
  for(var name in pkg.dependencies) {
    var version = pkg.dependencies[name];
    // This heuristic is necessarily correct (unless npm changes its spec)
    // because package names are required to be url-safe (so slashes are out)
    // and the other two options are an actual URL which necessarily includes
    // a /, or a github-shorthand-url (e.g. visionmedia/express), which also
    // requires the presence of a /.
    if(version.indexOf('/') !== -1)
      gitPackages.push(version);
  }

  npm.commands.install(gitPackages, function(err, data) {
    if(err) throw err;
  });
  npm.on('log', console.log.bind(console));
});